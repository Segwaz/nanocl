Kind: Deployment
ApiVersion: v0.11

Namespace: global

Secrets:
  - Key: env.deploy-example.com
    Kind: Env
    Metadata:
      Selector:
        App: deploy-example
    Data:
      - MY_VALUE=MY_KEY

# See all options:
# https://docs.next-hat.com/references/nanocl/resource
Resources:
  - Name: deploy-example.com
    Kind: ProxyRule
    Version: v0.8
    Metadata:
      CertManager: certbot
      Selector:
        App: deploy-example
    Data:
      Rules:
        - Domain: deploy-example.com
          Network: All
          Locations:
            - Path: /
              Target:
                Key: deploy-example2.global.c
                Port: 9000
            - Path: /v1
              Target:
                Key: deploy-example.global.c
                Port: 9000
            - Path: /v2
              Target:
                Key: deploy-example2.global.c
                Port: 9000

# See all options:
# https://docs.next-hat.com/references/nanocl/cargo
Cargoes:
  - Name: deploy-example
    Metadata:
      Selector:
        App: deploy-example
    Secrets:
      - env.deploy-example.com
    InitContainer:
      Image: alpine:latest
      Cmd: ["sleep", "1"]
    Container:
      Image: ghcr.io/nxthat/nanocl-get-started:latest
      Env:
        - APP=GET_STARTED

  - Name: deploy-example2
    Container:
      Replication:
        Name: Static
        Number: 3
      Image: ghcr.io/nxthat/nanocl-get-started:latest
      Env:
        - APP=GET_STARTED2
