Type: Deployment
ApiVersion: v0.4

Namespace: system

Cargoes:
- Name: proxy
  Container:
    Image: nanocl-nginx:dev
    Tty: true
    HostConfig:
      NetworkMode: host
      Binds:
      - {state_dir}/proxy/html:/usr/share/nginx/html
      - {state_dir}/proxy/conf.d:/etc/nginx/conf.d
      - {state_dir}/proxy/sites-enabled:/etc/nginx/sites-enabled
      - {state_dir}/proxy/streams-enabled:/etc/nginx/streams-enabled

- Name: ncdproxy
  Container:
    Image: ghcr.io/nxthat/nanocl-dev:dev
    Cmd:
    - watch
    - -x
    - run --no-default-features --features dev --bin ncdproxy
    Tty: true
    HostConfig:
      NetworkMode: system
      Binds:
      - ./:/project
      - /usr/local/cargo/registry/cache:/usr/local/cargo/registry/cache
      - {state_dir}/proxy/conf.d:/etc/nginx/conf.d
      - {state_dir}/proxy/sites-enabled:/etc/nginx/sites-enabled
      - {state_dir}/proxy/streams-enabled:/etc/nginx/streams-enabled
      - /run/nanocl:/run/nanocl
